var net = require('net');
var log4js = require('log4js');
var varint = require('varint');
var BufferReader = require('buffer-reader');
var Connection = require('./connection.js');
var Util = require('./util.js');
var ServerStatus = require('./serverStatus.js');


var logger = log4js.getLogger();

exports.start = function()
{
    var server = new net.createServer(function(c) 
    {
        logger.info("client connected");
        var conn = new Connection(c);
        c.on('end', function() {
            logger.info("client disconnected");
            conn.close();
            conn = undefined;
        }); 
        c.on('data', function(buff) {
            conn.handlePacket(buff, new ServerStatus(exports.VERSION, {"max": exports.maxPlayers, "online": exports.onlinePlayers}, exports.description, exports.favicon));
        });
    });
    server.on('error', function(err) {
        logger.fatal(err); 
    });
    server.listen(25565, function() {
        logger.info("server bound");
    })
}

exports.VERSION = {"name": "1.10", "protocol": 210};
exports.maxPlayers = 20;
exports.onlinePlayers = 0;
exports.description = {"text": "Test test test", "color": "red", "bold": "true"};
exports.favicon = "data:image/png;base64,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";